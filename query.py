#Pour les query dans la base de donnée intégration, le chemin vers les tables est --> \"PUBLIC\".ANIS.\"REC_ANIS\".ANIS.\"TBxxx\"
#Pour les query dans la base de donnée production, le chemin vers les tables est --> \"PUBLIC\".ANIS.\"TBxxx\"
#Pour les query dans la base de donnée publique, le chemin est --> \"PUBLIC\".ANIS.\"TBxxx\"

def query_to_get_gmr():
  return "SELECT DISTINCT TB009_GMR.LIBELLE AS GMR FROM \"PUBLIC\".ANIS.\"TB009_GMR\""

def query_to_get_og_ni(date_end, date_start, gmr) :
  return f"SELECT TB025_OPERATION_GLOBALE.NUMERO_OG, TB001_NOTE_INFORMATION.NUMERO_NI, TB017_PARTIE_PRENANTE_RGPD.TYPE, TB009_GMR.ID_GMR, TB009_GMR.LIBELLE,  TB017_PARTIE_PRENANTE_RGPD.CODE, TB017_PARTIE_PRENANTE_RGPD.NOM, TB001_NOTE_INFORMATION.STATUT_NI FROM \"PUBLIC\".ANIS.\"TB001_NOTE_INFORMATION\" LEFT JOIN \"PUBLIC\".ANIS.\"TB005_NI_OU\" ON TB001_NOTE_INFORMATION.ID_NI = TB005_NI_OU.ID_NI LEFT JOIN \"PUBLIC\".ANIS.\"TB004_OPERATION_UNITAIRE\" ON TB005_NI_OU.ID_OU = TB004_OPERATION_UNITAIRE.ID_OU LEFT JOIN \"PUBLIC\".ANIS.\"TB007_OUVRAGE\" ON TB004_OPERATION_UNITAIRE.ID_OUVRAGE = TB007_OUVRAGE.ID_OUVRAGE LEFT JOIN \"PUBLIC\".ANIS.\"TB015_OUVRAGE_GDP\" ON TB004_OPERATION_UNITAIRE.ID_OUVRAGE = TB015_OUVRAGE_GDP.ID_OUVRAGE LEFT JOIN \"PUBLIC\".ANIS.\"TB014_GDP\" ON TB015_OUVRAGE_GDP.ID_GDP = TB014_GDP.ID_GDP LEFT JOIN \"PUBLIC\".ANIS.\"TB009_GMR\" ON TB014_GDP.ID_GMR = TB009_GMR.ID_GMR LEFT JOIN \"PUBLIC\".ANIS.\"TB020_NI_PP\" ON TB005_NI_OU.ID_NI = TB020_NI_PP.ID_NI LEFT JOIN \"PUBLIC\".ANIS.\"TB017_PARTIE_PRENANTE_RGPD\" ON TB020_NI_PP.ID_PP = TB017_PARTIE_PRENANTE_RGPD.ID_PARTIE_PRENANTE LEFT JOIN \"PUBLIC\".ANIS.\"TB025_OPERATION_GLOBALE\" ON TB001_NOTE_INFORMATION.ID_OG = TB025_OPERATION_GLOBALE.ID_OG WHERE NOT (TB001_NOTE_INFORMATION.DATE_DEB_NI > TO_DATE('{date_end}','YYYY-MM-DD') OR TB001_NOTE_INFORMATION.DATE_FIN_NI < TO_DATE('{date_start}','YYYY-MM-DD')) AND TB025_OPERATION_GLOBALE.NUMERO_OG IN ( SELECT NUMERO_OG FROM \"PUBLIC\".ANIS.\"TB001_NOTE_INFORMATION\" LEFT JOIN \"PUBLIC\".ANIS.\"TB025_OPERATION_GLOBALE\" ON TB001_NOTE_INFORMATION.ID_OG = TB025_OPERATION_GLOBALE.ID_OG LEFT JOIN \"PUBLIC\".ANIS.\"TB005_NI_OU\" ON TB001_NOTE_INFORMATION.ID_NI = TB005_NI_OU.ID_NI LEFT JOIN \"PUBLIC\".ANIS.\"TB004_OPERATION_UNITAIRE\" ON TB005_NI_OU.ID_OU = TB004_OPERATION_UNITAIRE.ID_OU GROUP BY NUMERO_OG HAVING COUNT(ALL NUMERO_OG) > 1) AND TB025_OPERATION_GLOBALE.NUMERO_OG IN ( SELECT DISTINCT TB025_OPERATION_GLOBALE.NUMERO_OG FROM \"PUBLIC\".ANIS.\"TB001_NOTE_INFORMATION\" LEFT JOIN \"PUBLIC\".ANIS.\"TB005_NI_OU\" ON TB001_NOTE_INFORMATION.ID_NI = TB005_NI_OU.ID_NI LEFT JOIN \"PUBLIC\".ANIS.\"TB004_OPERATION_UNITAIRE\" ON TB005_NI_OU.ID_OU = TB004_OPERATION_UNITAIRE.ID_OU LEFT JOIN \"PUBLIC\".ANIS.\"TB015_OUVRAGE_GDP\" ON TB004_OPERATION_UNITAIRE.ID_OUVRAGE = TB015_OUVRAGE_GDP.ID_OUVRAGE LEFT JOIN \"PUBLIC\".ANIS.\"TB014_GDP\" ON TB015_OUVRAGE_GDP.ID_GDP = TB014_GDP.ID_GDP LEFT JOIN \"PUBLIC\".ANIS.\"TB009_GMR\" ON TB014_GDP.ID_GMR = TB009_GMR.ID_GMR LEFT JOIN \"PUBLIC\".ANIS.\"TB025_OPERATION_GLOBALE\" ON TB001_NOTE_INFORMATION.ID_OG = TB025_OPERATION_GLOBALE.ID_OG AND TB009_GMR.LIBELLE LIKE '%{gmr}%') ORDER BY NUMERO_OG DESC"

def query_get_operation_intervention(operation):
  return f"SELECT TB004_OPERATION_UNITAIRE.ID_OU, TB018_OU_PP.ID_OU, TB025_OPERATION_GLOBALE.NUMERO_OG, TB001_NOTE_INFORMATION.NUMERO_NI, TB001_NOTE_INFORMATION.DATE_DEB_NI, TB001_NOTE_INFORMATION.DATE_FIN_NI, TB002_INDICE.NUMERO_INDICE, TB004_OPERATION_UNITAIRE.LIBELLE_OU, TB004_OPERATION_UNITAIRE.NUMERO_OU, TB007_OUVRAGE.IDR, TB007_OUVRAGE.ADR, TB014_GDP.CODE AS CODE_TB14, TB017_PARTIE_PRENANTE_RGPD.NOM, TB017_PARTIE_PRENANTE_RGPD.CODE AS CODE_TB17, TB009_GMR.LIBELLE AS GMR, TB009_GMR.ID_GMR FROM \"PUBLIC\".ANIS.\"TB001_NOTE_INFORMATION\" LEFT JOIN \"PUBLIC\".ANIS.\"TB002_INDICE\" ON TB001_NOTE_INFORMATION.ID_NI = TB002_INDICE.ID_NI LEFT JOIN \"PUBLIC\".ANIS.\"TB005_NI_OU\" ON TB001_NOTE_INFORMATION.ID_NI = TB005_NI_OU.ID_NI  LEFT JOIN \"PUBLIC\".ANIS.\"TB004_OPERATION_UNITAIRE\" ON TB005_NI_OU.ID_OU = TB004_OPERATION_UNITAIRE.ID_OU  LEFT JOIN \"PUBLIC\".ANIS.\"TB007_OUVRAGE\" ON TB004_OPERATION_UNITAIRE.ID_OUVRAGE = TB007_OUVRAGE.ID_OUVRAGE  LEFT JOIN \"PUBLIC\".ANIS.\"TB015_OUVRAGE_GDP\" ON TB004_OPERATION_UNITAIRE.ID_OUVRAGE = TB015_OUVRAGE_GDP.ID_OUVRAGE  LEFT JOIN \"PUBLIC\".ANIS.\"TB014_GDP\" ON TB015_OUVRAGE_GDP.ID_GDP = TB014_GDP.ID_GDP  LEFT JOIN \"PUBLIC\".ANIS.\"TB009_GMR\" ON TB014_GDP.ID_GMR = TB009_GMR.ID_GMR  LEFT JOIN \"PUBLIC\".ANIS.\"TB018_OU_PP\" ON TB005_NI_OU.ID_OU = TB018_OU_PP.ID_OU  LEFT JOIN \"PUBLIC\".ANIS.\"TB017_PARTIE_PRENANTE_RGPD\" ON TB018_OU_PP.ID_PP = TB017_PARTIE_PRENANTE_RGPD.ID_PARTIE_PRENANTE  LEFT JOIN \"PUBLIC\".ANIS.\"TB025_OPERATION_GLOBALE\" ON TB001_NOTE_INFORMATION.ID_OG = TB025_OPERATION_GLOBALE.ID_OG WHERE TB004_OPERATION_UNITAIRE.ID_OG='{operation}' AND TB002_INDICE.NUMERO_INDICE IN (SELECT MAX(NUMERO_INDICE) FROM \"PUBLIC\".ANIS.\"TB001_NOTE_INFORMATION\" LEFT JOIN \"PUBLIC\".ANIS.\"TB002_INDICE\" ON TB001_NOTE_INFORMATION.ID_NI = TB002_INDICE.ID_NI LEFT JOIN \"PUBLIC\".ANIS.\"TB005_NI_OU\" ON TB001_NOTE_INFORMATION.ID_NI = TB005_NI_OU.ID_NI LEFT JOIN \"PUBLIC\".ANIS.\"TB004_OPERATION_UNITAIRE\" ON TB005_NI_OU.ID_OU = TB004_OPERATION_UNITAIRE.ID_OU WHERE TB004_OPERATION_UNITAIRE.ID_OG='{operation}') "

def query_get_equipes_pilotes(gmr):
  return f"SELECT TB023_EQUIPE_RGPD.CODE FROM \"PUBLIC\".ANIS.\"TB023_EQUIPE_RGPD\" LEFT JOIN \"PUBLIC\".ANIS.\"TB009_GMR\" ON TB009_GMR.ID_GMR = TB023_EQUIPE_RGPD.ID_GMR WHERE TB009_GMR.LIBELLE = '{gmr}'"

def query_get_id_og_from_numero_og(numero_og):
  return f"SELECT ID_OG FROM \"PUBLIC\".ANIS.\"TB025_OPERATION_GLOBALE\" WHERE NUMERO_OG = '{numero_og}'"

def query_get_id_og_from_numero_ni(numero_ni):
  return f"SELECT ID_OG FROM \"PUBLIC\".ANIS.\"TB001_NOTE_INFORMATION\" WHERE NUMERO_NI = '{numero_ni}'"

def query_get_equipes_intervenantes(numero_ni):
  return f"SELECT CODE FROM \"PUBLIC\".ANIS.\"TB017_PARTIE_PRENANTE_RGPD\" LEFT JOIN \"PUBLIC\".ANIS.\"TB020_NI_PP\" ON TB017_PARTIE_PRENANTE_RGPD.ID_PARTIE_PRENANTE = TB020_NI_PP.ID_PP LEFT JOIN \"PUBLIC\".ANIS.\"TB001_NOTE_INFORMATION\" ON TB020_NI_PP.ID_NI = TB001_NOTE_INFORMATION.ID_NI WHERE NUMERO_NI ='{numero_ni}' AND TYPE != 'Client' AND NOM NOT LIKE '%COSE%'"